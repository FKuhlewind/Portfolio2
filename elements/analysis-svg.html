<link rel="import" href="../bower_components/polymer/polymer.html">

<polymer-element name="analysis-svg" attributes="svgData">

<template>

  <svg width="500" height="400" xmlns="http://www.w3.org/2000/svg">
    <rect id="svg_1" height="400" width="500" y="0" x="0" fill="rgba(0,0,0,0.1)"/>
    <g class="bars">
      <template repeat="{{data in graphData}}">
        <rect height="30" width="{{data.width}}" y="{{data.yPos}}" x="{{data.xPos}}" fill="{{data.color}}"/>
      </template>
    </g>
    <g class="text">
      <template repeat="{{data in graphData}}">
        <text text-anchor="middle" font-family="'Trebuchet MS'" font-size="16" y="{{data.textPos}}" x="250" fill="#ffffff">{{data.text}} ({{data.score}})</text>
      </template>
    </g>
  </svg>

</template>

<script>

Polymer('analysis-svg', {
      svgData: [],
      graphData: [],
      temp: [],
      svgDataChanged: function () {
        for (var i = 0; i < 10; i++) {
            this.temp[i] = this.svgData[i].relevance;
            };
        this.mini = Math.min.apply(null,this.temp);
        this.maxi = Math.max.apply(null,this.temp);
        this.diff = this.maxi - this.mini;
        for (var i = 0; i < 10; i++) {
            this.width = ( 400 / this.diff * this.svgData[i].relevance ) + ( 50 - (400 / this.diff * this.mini) );
            this.temp2 = Math.round(this.svgData[i].sentimScore*10)/10; 
            if ( this.temp2 < 0)
               {this.color = "rgba("+Math.round(Math.abs(85*this.svgData[i].sentimScore+170))+", 0, 0, 0.8)"}
            else if ( this.temp2 > 0)
              {this.color = "rgba(0,"+Math.round(Math.abs(85*this.svgData[i].sentimScore+170))+", 0, 0.8)"}
            else
              {this.color = "rgba(0,0,0,0.2)"};
            this.graphData[i]= { text: this.svgData[i].text ,
                            width: this.width ,
                            xPos: ( (500 - this.width) / 2 ),
                            yPos: ( ( i * 40 ) + 5 ),  
                            textPos: ( ( i * 40 ) + 27 ),
                            color: this.color, 
                            score: Math.round(this.svgData[i].sentimScore*10)/10 };
            };
        },
});

</script>

</polymer-element>